"use strict";(self.webpackChunksuperheroes=self.webpackChunksuperheroes||[]).push([[463],{6463:(Nt,D,c)=>{c.r(D),c.d(D,{ChatParticipantModule:()=>Bt});var A=c(9808),b=c(3007),L=(()=>{return(i=L||(L={}))[i.Create=0]="Create",i[i.DeleteAll=1]="DeleteAll",i[i.Logout=2]="Logout",i[i.Refresh=3]="Refresh",L;var i})(),S=(()=>{return(i=S||(S={}))[i.View=0]="View",i[i.Delete=1]="Delete",S;var i})(),n=c(5620),l=(()=>{return(i=l||(l={})).GET_CHAT_PARTICIPANT_LIST="[Chat-Participant] Get Chat-Participant list",i.SET_CHAT_PARTICIPANT_LIST="[Chat-Participant] Set Chat-Participant list",i.ADD_CHAT_PARTICIPANT_API="[Chat-Participant] Add Chat-Participant (API)",i.ADD_CHAT_PARTICIPANT_STATE="[Chat-Participant] Add Chat-Participant (STATE)",i.MODIFY_CHAT_PARTICIPANT_API="[Chat-Participant] Modify Chat-Participant (API)",i.MODIFY_CHAT_PARTICIPANT_STATE="[Chat-Participant] Modify Chat-Participant (STATE)",i.REMOVE_CHAT_PARTICIPANT_API="[Chat-Participant] Remove Chat-Participant (API)",i.REMOVE_CHAT_PARTICIPANT_STATE="[Chat-Participant] Remove Chat-Participant (STATE)",i.REMOVE_ALL_CHAT_PARTICIPANT_API="[Chat-Participant] Remove All Chat-Participant (API)",i.REMOVE_ALL_CHAT_PARTICIPANT_STATE="[Chat-Participant] Remove ALL Chat-Participant (STATE)",l;var i})();(0,n.PH)(l.GET_CHAT_PARTICIPANT_LIST);const j=(0,n.PH)(l.SET_CHAT_PARTICIPANT_LIST,(0,n.Ky)()),Y=(0,n.PH)(l.ADD_CHAT_PARTICIPANT_STATE,(0,n.Ky)()),$=(0,n.PH)(l.MODIFY_CHAT_PARTICIPANT_STATE,(0,n.Ky)()),J=(0,n.PH)(l.REMOVE_CHAT_PARTICIPANT_STATE,(0,n.Ky)()),V=(0,n.PH)(l.REMOVE_ALL_CHAT_PARTICIPANT_STATE),B=(0,n.ZF)("chatParticipantState");var N=c(727),p=(()=>{return(i=p||(p={})).GET_BLOCKED_USERS_LIST_LIST="[Blocked-Users-List] Get Blocked-Users-List list",i.SET_BLOCKED_USERS_LIST_LIST="[Blocked-Users-List] Set Blocked-Users-List list",i.ADD_BLOCKED_USERS_LIST_API="[Blocked-Users-List] Add Blocked-Users-List (API)",i.ADD_BLOCKED_USERS_LIST_STATE="[Blocked-Users-List] Add Blocked-Users-List (STATE)",i.MODIFY_BLOCKED_USERS_LIST_API="[Blocked-Users-List] Modify Blocked-Users-List (API)",i.MODIFY_BLOCKED_USERS_LIST_STATE="[Blocked-Users-List] Modify Blocked-Users-List (STATE)",i.REMOVE_BLOCKED_USERS_LIST_API="[Blocked-Users-List] Remove Blocked-Users-List (API)",i.REMOVE_BLOCKED_USERS_LIST_STATE="[Blocked-Users-List] Remove Blocked-Users-List (STATE)",i.REMOVE_ALL_BLOCKED_USERS_LIST_API="[Blocked-Users-List] Remove All Blocked-Users-List (API)",i.REMOVE_ALL_BLOCKED_USERS_LIST_STATE="[Blocked-Users-List] Remove ALL Blocked-Users-List (STATE)",p;var i})();(0,n.PH)(p.GET_BLOCKED_USERS_LIST_LIST);const Q=(0,n.PH)(p.SET_BLOCKED_USERS_LIST_LIST,(0,n.Ky)()),z=(0,n.PH)(p.ADD_BLOCKED_USERS_LIST_STATE,(0,n.Ky)()),q=(0,n.PH)(p.MODIFY_BLOCKED_USERS_LIST_STATE,(0,n.Ky)()),X=(0,n.PH)(p.REMOVE_BLOCKED_USERS_LIST_STATE,(0,n.Ky)()),tt=(0,n.PH)(p.REMOVE_ALL_BLOCKED_USERS_LIST_STATE),F=(0,n.ZF)("blockedUsersListState");var t=c(5e3),f=c(8505),d=c(262),u=c(2843),C=c(2340),E=c(520);let k=(()=>{class i{constructor(e){this.http=e,this.isChatCreated=!1,this.blocked=[]}getChatParticipants(){return this.http.get(`${C.N.apiURL}/chat-participants`).pipe((0,f.b)(e=>e),(0,d.K)(e=>(0,u._)(()=>e)))}deleteOldPosts(e){let a=new Date,o=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()),r=new Date(o).toISOString().replace("T"," ");return e.slice(0,13)==r.slice(0,13)}getChatParticipant(e){return this.http.get(`${C.N.apiURL}/chat-participants/${e}`).pipe((0,f.b)(a=>a),(0,d.K)(a=>(0,u._)(()=>a)))}addChatParticipant(e){return this.http.post(`${C.N.apiURL}/chat-participants`,e).pipe((0,f.b)(a=>a),(0,d.K)(a=>(0,u._)(()=>a)))}updateChatParticipant(e,a){return this.http.put(`${C.N.apiURL}/chat-participants/${e}`,a).pipe((0,d.K)(o=>(0,u._)(()=>o)))}deleteChatParticipant(e){return this.http.delete(`${C.N.apiURL}/chat-participants/${e}`).pipe((0,d.K)(a=>(0,u._)(()=>a)))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(E.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var it=c(4594),v=c(7423),R=c(5245);const y=function(i){return{hidden:i,buttonMarginLeft:!0}};function at(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",0),t.NdJ("click",function(){return t.CHM(e),t.oxw().emitAction(3)}),t.TgZ(1,"mat-icon"),t._uU(2,"refresh"),t.qZA(),t._uU(3," Start Refresh "),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("ngClass",t.VKq(1,y,1!=e.chatParticipantService.isChatCreated))}}function st(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",0),t.NdJ("click",function(){return t.CHM(e),t.oxw().emitAction(3)}),t.TgZ(1,"mat-icon"),t._uU(2,"refresh"),t.qZA(),t._uU(3," Stop Refresh "),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("ngClass",t.VKq(1,y,1!=e.chatParticipantService.isChatCreated))}}const w=function(i){return{hidden:i}},rt=function(){return{buttonMarginLeft:!0}};let nt=(()=>{class i{constructor(e){this.action=new t.vpe,this.chatParticipantService=e}emitAction(e){this.isActionCreate(e)?localStorage.setItem("mainPage","false"):this.isActionLogOut(e)&&(this.chatParticipantService.chatWith=""),this.action.emit(e)}isActionCreate(e){return 0==e}isActionLogOut(e){return 2==e}isRefreshSameAsInput(e){return localStorage.getItem("refresh")==e}isNotCurrentUserSuperuser(){return"superuser@mail.com"!=localStorage.getItem("userEmail")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(k))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-chat-participant-command-bar"]],outputs:{action:"action"},decls:17,vars:10,consts:[["mat-raised-button","","color","primary",3,"ngClass","click"],["mat-raised-button","","color","warn",3,"ngClass","click"],["mat-raised-button","","color","primary",3,"ngClass","click",4,"ngIf"],["mat-raised-button","","color","accent",3,"ngClass","click"]],template:function(e,a){1&e&&(t.TgZ(0,"p")(1,"mat-toolbar")(2,"button",0),t.NdJ("click",function(){return a.emitAction(0)}),t.TgZ(3,"mat-icon"),t._uU(4,"fiber_new"),t.qZA(),t._uU(5," Create "),t.qZA(),t._uU(6," \xa0 "),t.TgZ(7,"button",1),t.NdJ("click",function(){return a.emitAction(1)}),t.TgZ(8,"mat-icon"),t._uU(9,"delete"),t.qZA(),t._uU(10," Delete All "),t.qZA(),t.YNc(11,at,4,3,"button",2),t.YNc(12,st,4,3,"button",2),t.TgZ(13,"button",3),t.NdJ("click",function(){return a.emitAction(2)}),t.TgZ(14,"mat-icon"),t._uU(15,"power_settings_new"),t.qZA(),t._uU(16," Log Out "),t.qZA()()()),2&e&&(t.xp6(2),t.Q6J("ngClass",t.VKq(5,w,1!=a.chatParticipantService.isChatCreated)),t.xp6(5),t.Q6J("ngClass",t.VKq(7,w,1!=a.chatParticipantService.isChatCreated||a.isNotCurrentUserSuperuser())),t.xp6(4),t.Q6J("ngIf",a.isRefreshSameAsInput("false")),t.xp6(1),t.Q6J("ngIf",a.isRefreshSameAsInput("true")),t.xp6(1),t.Q6J("ngClass",t.DdM(9,rt)))},directives:[it.Ye,v.lW,A.mk,R.Hw,A.O5],styles:[".hidden[_ngcontent-%COMP%]{display:none}mat-toolbar[_ngcontent-%COMP%]{border-radius:15px}.mat-raised-button[_ngcontent-%COMP%]{border-radius:10px}.buttonMarginLeft[_ngcontent-%COMP%]{margin-left:6px}"]}),i})();var I=c(4847),_=c(2781),m=c(3075);let M=(()=>{class i{constructor(e){this.http=e,this.exists=!1}getBlockedUsersLists(){return this.http.get(`${C.N.apiURL}/blocked-users-lists`).pipe((0,f.b)(e=>e),(0,d.K)(e=>(0,u._)(()=>e)))}getBlockedUsersList(e){return this.http.get(`${C.N.apiURL}/blocked-users-lists/${e}`).pipe((0,f.b)(a=>a),(0,d.K)(a=>(0,u._)(()=>a)))}addBlockedUsersList(e){return this.http.post(`${C.N.apiURL}/blocked-users-lists`,e).pipe((0,f.b)(a=>a),(0,d.K)(a=>(0,u._)(()=>a)))}updateBlockedUsersList(e){return this.http.put(`${C.N.apiURL}/blocked-users-lists/${e.id}`,e).pipe((0,d.K)(a=>(0,u._)(()=>a)))}deleteBlockedUsersList(e){return this.http.delete(`${C.N.apiURL}/blocked-users-lists/${e}`).pipe((0,d.K)(a=>(0,u._)(()=>a)))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(E.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ot=(()=>{class i{constructor(e){this.http=e}getUsers(){return this.http.get(`${C.N.apiURL}/users`).pipe((0,f.b)(e=>e),(0,d.K)(e=>(0,u._)(()=>e)))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(E.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var O=c(4106),x=c(7531);function ct(i,s){if(1&i&&(t.TgZ(0,"th",17),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.headerName," ")}}function lt(i,s){if(1&i&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&i){const e=s.$implicit,a=t.oxw().$implicit;t.xp6(1),t.hij(" ",e[a.fieldName]," ")}}function ht(i,s){1&i&&(t.ynx(0,14),t.YNc(1,ct,2,1,"th",15),t.YNc(2,lt,2,1,"td",16),t.BQk()),2&i&&t.Q6J("matColumnDef",s.$implicit.fieldName)}function pt(i,s){1&i&&(t.TgZ(0,"th",19),t._uU(1," Actions "),t.qZA())}function dt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",23),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().selectChatParticipant(o,0)}),t.TgZ(1,"mat-icon"),t._uU(2,"pageview"),t.qZA(),t._uU(3," View "),t.qZA()}}function mt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().selectChatParticipant(o,1)}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA(),t._uU(3," Delete "),t.qZA()}}function ut(i,s){if(1&i&&(t.TgZ(0,"td",20),t.YNc(1,dt,4,0,"button",21),t._uU(2," \xa0 "),t.YNc(3,mt,4,0,"button",22),t.qZA()),2&i){const e=s.$implicit,a=t.oxw();t.xp6(1),t.Q6J("ngIf",a.areViewActionAndDeleteActionVisible(e)),t.xp6(2),t.Q6J("ngIf",a.areViewActionAndDeleteActionVisible(e))}}function Ct(i,s){1&i&&t._UZ(0,"tr",25)}function _t(i,s){1&i&&t._UZ(0,"tr",26)}function ft(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw().createChat()}),t._uU(1,"Create chat"),t.qZA()}}const Z=function(){return{formFieldMargin:!0}},Tt=function(){return{findMargin:!0}};let Pt=(()=>{class i{constructor(e,a,o,r){this.store=r,this.headers=[],this.chatParticipants=[],this.blockedUsersLists=[],this.chatParticipant=new t.vpe,this.headerFields=[],this.users=[],this.userEmails=[],this.personForm=new m.cw({mailName:new m.NI}),this.isUserEmailFoundAndNotBlocked=!1,this.blockedForm=new m.cw({blocked:new m.NI}),this.blockedUsersListList=[],this.isInitAddingBlockedUsersListCheck=!0,this.chatParticipantService=e,this.blockedUsersListService=a,this.userService=o}ngOnChanges(){if(null!=this.chatParticipants&&this.chatParticipants)if(this.prepareAndInitializeDataSource(),this.isInitAddingBlockedUsersListCheck){let e={id:"3fa85f64-5717-4562-b3fc-2c963f66afa6",userEmail:localStorage.getItem("userEmail"),blockedUsersList:["user9999@mail.com"]};this.setUserEmailsAndOthers(e),null!=this.blockedUsersLists&&this.blockedUsersLists&&this.initBlockedInForm()}else this.setUserEmailsAndOthers()}prepareAndInitializeDataSource(){let e=this.leaveOnlyChatParticipantsWithCurrentHour();e=this.leaveOnlyTwoSpeakersInChat(e),this.dataSource=new _.by(e),this.dataSource.sort=this.sort}leaveOnlyChatParticipantsWithCurrentHour(){return this.chatParticipants.filter(e=>e.createdAt.slice(0,13)==new Date(Date.UTC((new Date).getUTCFullYear(),(new Date).getUTCMonth(),(new Date).getUTCDate(),(new Date).getUTCHours(),(new Date).getUTCMinutes(),(new Date).getUTCSeconds())).toISOString().replace("T"," ").slice(0,13))}leaveOnlyTwoSpeakersInChat(e){return e.filter(a=>a.speaker==localStorage.getItem("userEmail")&&a.chatWith==this.personForm.controls.mailName.value||a.speaker==this.personForm.controls.mailName.value&&a.chatWith==localStorage.getItem("userEmail"))}setUserEmailsAndOthers(e){this.userService.getUsers().subscribe(a=>{this.setUserEmailsShorter(a),this.blockedUsersListService.getBlockedUsersLists().subscribe(o=>{if(o.length>0&&(this.blockedUsersListList=o,this.isInitAddingBlockedUsersListCheck)){for(let r=0;r<this.blockedUsersListList.length;r++)r=this.addBlockedUsersListToNgrxOrNot(r,e);this.isInitAddingBlockedUsersListCheck=!1}})})}setUserEmailsShorter(e){this.users=e,this.users.filter(a=>this.userEmails.push(a.email))}addBlockedUsersListToNgrxOrNot(e,a){return this.blockedUsersListList[e].userEmail==localStorage.getItem("userEmail")?e=this.blockedUsersListList.length:e==this.blockedUsersListList.length-1&&this.store.dispatch({type:p.ADD_BLOCKED_USERS_LIST_API,payload:a}),e}initBlockedInForm(){for(let e=0;e<this.blockedUsersLists.length;e++)this.blockedUsersLists[e].userEmail==localStorage.getItem("userEmail")&&this.blockedForm.patchValue({blocked:this.blockedUsersLists[e].blockedUsersList})}ngOnInit(){this.getHeaderFields(),this.personForm.patchValue({mailName:this.chatParticipantService.chatWith}),setInterval(()=>{"true"==localStorage.getItem("mainPage")&&"true"==localStorage.getItem("refresh")&&(this.store.dispatch({type:p.GET_BLOCKED_USERS_LIST_LIST}),null!=this.blockedUsersLists&&this.blockedUsersLists&&this.initBlockedInForm())},3e4)}getHeaderFields(){this.headerFields=this.headers.map(e=>e.fieldName),this.headerFields.push("actions")}selectChatParticipant(e,a){"true"==localStorage.getItem("mainPage")&&((this.isViewAction(a)&&localStorage.getItem("userEmail")==e.speaker||this.isDeleteAction(a))&&this.chatParticipant.emit({chatParticipant:e,action:a}),this.isViewAction(a)&&localStorage.setItem("mainPage","false"))}isViewAction(e){return 0==e}isDeleteAction(e){return 1==e}areViewActionAndDeleteActionVisible(e){return localStorage.getItem("userEmail")==e.speaker}checkIfUserEmailFoundAndNotBlocked(){this.setBlockedUsersListObject();for(let e=0;e<this.userEmails.length;e++)if(this.isUserEmailRegisteredAndNotCurrentUser(e))if(this.isBlockedInFormMultiElements()){this.blockedUsersListObject.blockedUsersList=this.blockedForm.controls.blocked.value.toString().split(",");for(let a=0;a<this.blockedUsersListObject.blockedUsersList.length;a++)a=this.setUserEmailFoundAndNotBlocked(a)}else this.blockedUsersListObject=Object.freeze({id:this.blockedUsersListObject.id,userEmail:this.blockedUsersListObject.userEmail,blockedUsersList:this.blockedForm.controls.blocked.value.toString()}),this.blockedUsersListObject={id:this.blockedUsersListObject.id,userEmail:this.blockedUsersListObject.userEmail,blockedUsersList:[this.blockedForm.controls.blocked.value.toString()]},this.setUserEmailFoundAndNotBlockedForSingleBlocked()}setBlockedUsersListObject(){for(let e=0;e<this.blockedUsersLists.length;e++)if(this.blockedUsersLists[e].userEmail==localStorage.getItem("userEmail")){this.blockedUsersListObject=Object.freeze({id:this.blockedUsersLists[e].id,userEmail:this.blockedUsersLists[e].userEmail,blockedUsersList:this.blockedUsersLists[e].blockedUsersList}),this.blockedUsersListObject={id:this.blockedUsersLists[e].id,userEmail:this.blockedUsersLists[e].userEmail,blockedUsersList:this.blockedUsersLists[e].blockedUsersList};break}}isUserEmailRegisteredAndNotCurrentUser(e){return this.personForm.controls.mailName.value==this.userEmails[e]&&this.personForm.controls.mailName.value!=localStorage.getItem("userEmail")}isBlockedInFormMultiElements(){return this.blockedForm.controls.blocked.value.toString().includes(",")}setUserEmailFoundAndNotBlocked(e){return this.isUserToBeBlocked(e)?(this.isUserEmailFoundAndNotBlocked=!1,this.chatParticipantService.isChatCreated=!1,e=this.blockedUsersListObject.blockedUsersList.length):e==this.blockedUsersListObject.blockedUsersList.length-1&&!this.chatParticipantService.isChatCreated&&(this.isUserEmailFoundAndNotBlocked=!0),e}isUserToBeBlocked(e){return this.blockedUsersListObject.blockedUsersList[e].toString()==this.personForm.controls.mailName.value.toString()}setUserEmailFoundAndNotBlockedForSingleBlocked(){this.blockedUsersListObject.blockedUsersList.toString()==this.personForm.controls.mailName.value.toString()?(this.isUserEmailFoundAndNotBlocked=!1,this.chatParticipantService.isChatCreated=!1):this.isUserEmailFoundAndNotBlocked=!0}createChat(){this.chatParticipantService.chatWith=this.personForm.controls.mailName.value,this.chatParticipantService.isChatCreated=!0,this.isUserEmailFoundAndNotBlocked=!this.isUserEmailFoundAndNotBlocked}handleBlockedListInFormAndInDatabaseAndInNgrx(){this.setBlockedUsersListObject(),this.isBlockedInFormMultiElements()?this.blockedUsersListObject.blockedUsersList=this.blockedForm.controls.blocked.value.toString().split(","):(this.blockedUsersListObject=Object.freeze({id:this.blockedUsersListObject.id,userEmail:this.blockedUsersListObject.userEmail,blockedUsersList:this.blockedForm.controls.blocked.value.toString()}),this.blockedUsersListObject={id:this.blockedUsersListObject.id,userEmail:this.blockedUsersListObject.userEmail,blockedUsersList:[this.blockedForm.controls.blocked.value.toString()]}),this.modifyBlockedUsersListInNgrx()}modifyBlockedUsersListInNgrx(){this.store.dispatch({type:p.MODIFY_BLOCKED_USERS_LIST_API,payload:this.blockedUsersListObject}),this.setValuesConnectedToModify()}setValuesConnectedToModify(){this.personForm.patchValue({mailName:""}),this.chatParticipantService.isChatCreated=!1,this.isUserEmailFoundAndNotBlocked=!1}isHidden(){return 1!=this.chatParticipantService.isChatCreated}hideChat(){this.chatParticipantService.isChatCreated=!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(k),t.Y36(M),t.Y36(ot),t.Y36(n.yh))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-chat-participant-list"]],viewQuery:function(e,a){if(1&e&&t.Gf(I.YE,5),2&e){let o;t.iGM(o=t.CRH())&&(a.sort=o.first)}},inputs:{headers:"headers",chatParticipants:"chatParticipants",blockedUsersLists:"blockedUsersLists"},outputs:{chatParticipant:"chatParticipant"},features:[t.TTD],decls:26,vars:15,consts:[["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","chatParticipantsCell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","chatParticipantsRow",4,"matRowDef","matRowDefColumns"],[3,"formGroup"],["appearance","fill",3,"ngClass"],["matInput","","formControlName","blocked","placeholder","Ex. student@mail.com,user@mail.com",3,"input"],["type","submit","mat-raised-button","","color","primary",3,"click"],["matInput","","formControlName","mailName","placeholder","Ex. student@mail.com",3,"input"],["type","submit","mat-raised-button","","color","primary",3,"ngClass","click"],["type","submit","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","chatParticipantElement",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"chatParticipantElement"],["mat-header-cell",""],["mat-cell","",1,"chatParticipantsCell"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row","",1,"chatParticipantsRow"]],template:function(e,a){1&e&&(t.TgZ(0,"table",0),t.YNc(1,ht,3,1,"ng-container",1),t.ynx(2,2),t.YNc(3,pt,2,0,"th",3),t.YNc(4,ut,4,2,"td",4),t.BQk(),t.YNc(5,Ct,1,0,"tr",5),t.YNc(6,_t,1,0,"tr",6),t.qZA(),t.ynx(7),t.TgZ(8,"form",7)(9,"mat-form-field",8)(10,"mat-label"),t._uU(11,"Blocked users list: "),t.qZA(),t.TgZ(12,"input",9),t.NdJ("input",function(){return a.hideChat()}),t.qZA()(),t._UZ(13,"br"),t.TgZ(14,"button",10),t.NdJ("click",function(){return a.handleBlockedListInFormAndInDatabaseAndInNgrx()}),t._uU(15,"Block users"),t.qZA()(),t.BQk(),t.ynx(16),t.TgZ(17,"form",7)(18,"mat-form-field",8)(19,"mat-label"),t._uU(20,"Chat with: "),t.qZA(),t.TgZ(21,"input",11),t.NdJ("input",function(){return a.hideChat()}),t.qZA()(),t._UZ(22,"br"),t.TgZ(23,"button",12),t.NdJ("click",function(){return a.checkIfUserEmailFoundAndNotBlocked()}),t._uU(24,"Find"),t.qZA(),t.YNc(25,ft,2,0,"button",13),t.qZA(),t.BQk()),2&e&&(t.ekj("hidden",a.isHidden()),t.Q6J("dataSource",a.dataSource),t.xp6(1),t.Q6J("ngForOf",a.headers),t.xp6(4),t.Q6J("matHeaderRowDef",a.headerFields),t.xp6(1),t.Q6J("matRowDefColumns",a.headerFields),t.xp6(2),t.Q6J("formGroup",a.blockedForm),t.xp6(1),t.Q6J("ngClass",t.DdM(12,Z)),t.xp6(8),t.Q6J("formGroup",a.personForm),t.xp6(1),t.Q6J("ngClass",t.DdM(13,Z)),t.xp6(5),t.Q6J("ngClass",t.DdM(14,Tt)),t.xp6(2),t.Q6J("ngIf",a.isUserEmailFoundAndNotBlocked))},directives:[_.BZ,I.YE,A.sg,_.w1,_.fO,_.ge,I.nU,_.Dz,_.ev,A.O5,v.lW,R.Hw,_.as,_.XQ,_.nj,_.Gk,m._Y,m.JL,m.sg,O.KE,A.mk,O.hX,x.Nt,m.Fj,m.JJ,m.u],styles:["table[_ngcontent-%COMP%]{width:100%}.chatParticipantElement[_ngcontent-%COMP%]{padding-right:24px;padding-top:24px;padding-bottom:24px}.chatParticipantsRow[_ngcontent-%COMP%]{white-space:pre-line;min-height:48px;max-height:1030px}.chatParticipantsCell[_ngcontent-%COMP%]{min-height:48px;max-height:1030px}.formFieldMargin[_ngcontent-%COMP%]{margin-top:10px}.findMargin[_ngcontent-%COMP%]{margin-right:10px}.hidden[_ngcontent-%COMP%]{display:none}.mat-raised-button[_ngcontent-%COMP%]{border-radius:10px}  table.mat-table{border-radius:15px}  .mat-table{background:none!important;box-shadow:2px 8px 4px -4px #3f51b5,2px 4px 4px #3f51b5,2px 6px 12px #3f51b5!important}  .mat-form-field-appearance-fill .mat-form-field-flex{border-radius:15px;margin-bottom:10px}  .mat-form-field-wrapper{padding-bottom:0}tr.mat-row[_ngcontent-%COMP%]:last-of-type   td.mat-cell[_ngcontent-%COMP%]:first-of-type, tr.mat-row[_ngcontent-%COMP%]:last-of-type   td.mat-cell[_ngcontent-%COMP%]:last-of-type{border-bottom-style:none}"]}),i})(),gt=(()=>{class i{constructor(e,a,o){this.router=e,this.store=a,this.chatParticipants=[],this.chatParticipants$=this.store.select((0,n.P1)(B,i=>i.chatParticipants)),this.blockedUsersLists=[],this.blockedUsersLists$=this.store.select((0,n.P1)(F,i=>i.blockedUsersLists)),this.subscriptionChP=N.w0.EMPTY,this.subscriptionBUL=N.w0.EMPTY,this.headers=[{headerName:"Speaker",fieldName:"speaker"},{headerName:"Content",fieldName:"talkContent"},{headerName:"CreatedAt",fieldName:"createdAt"},{headerName:"ChatWith",fieldName:"chatWith"}],this.chatParticipantsToDelete=[],this.chatParticipantService=o}ngOnInit(){localStorage.setItem("mainPage","true"),localStorage.setItem("refresh","true"),this.store.dispatch({type:l.GET_CHAT_PARTICIPANT_LIST}),this.assignChatParticipants(),this.deleteTooOldPosts(),this.store.dispatch({type:p.GET_BLOCKED_USERS_LIST_LIST}),this.assignBlockedUsersLists(),setInterval(()=>{"true"==localStorage.getItem("mainPage")&&"true"==localStorage.getItem("refresh")&&(this.deleteTooOldPosts(),this.store.dispatch({type:l.GET_CHAT_PARTICIPANT_LIST}))},2e3)}ngOnDestroy(){this.subscriptionChP.unsubscribe(),this.subscriptionBUL.unsubscribe()}assignChatParticipants(){this.subscriptionChP=this.chatParticipants$.subscribe(e=>{for(let a=0;a<e.length;a++)(null==e[a].createdAt||null==e[a].createdAt)&&e.splice(a,1);this.chatParticipants=e})}assignBlockedUsersLists(){this.subscriptionBUL=this.blockedUsersLists$.subscribe(e=>{this.blockedUsersLists=e})}selectChatParticipant(e){switch(e.action){case S.View:return void this.router.navigate(["chat-participants","form",e.chatParticipant.id]);case S.Delete:return void this.store.dispatch({type:l.REMOVE_CHAT_PARTICIPANT_API,payload:e.chatParticipant.id})}}executeCommandBarAction(e){switch(e){case L.Create:return void this.router.navigate(["chat-participants","form"]);case L.DeleteAll:return void this.store.dispatch({type:l.REMOVE_ALL_CHAT_PARTICIPANT_API,payload:[...this.chatParticipants.map(a=>a.id)]});case L.Logout:return localStorage.removeItem("token"),localStorage.removeItem("userEmail"),void this.refresh();case L.Refresh:return void("true"==localStorage.getItem("refresh")?localStorage.setItem("refresh","false"):localStorage.setItem("refresh","true"))}}refresh(){window.location.reload()}deleteTooOldPosts(){if(null!=this.chatParticipants&&this.chatParticipants.length>0){this.chatParticipantsToDelete=this.chatParticipants.filter(e=>e.createdAt.slice(0,13)!=new Date(Date.UTC((new Date).getUTCFullYear(),(new Date).getUTCMonth(),(new Date).getUTCDate(),(new Date).getUTCHours(),(new Date).getUTCMinutes(),(new Date).getUTCSeconds())).toISOString().replace("T"," ").slice(0,13));for(let e=0;e<this.chatParticipantsToDelete.length;e++)this.store.dispatch({type:l.REMOVE_CHAT_PARTICIPANT_API,payload:this.chatParticipantsToDelete[e].id})}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(b.F0),t.Y36(n.yh),t.Y36(k))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-list"]],decls:2,vars:3,consts:[[3,"action"],[3,"chatParticipants","blockedUsersLists","headers","chatParticipant"]],template:function(e,a){1&e&&(t.TgZ(0,"app-chat-participant-command-bar",0),t.NdJ("action",function(r){return a.executeCommandBarAction(r)}),t.qZA(),t.TgZ(1,"app-chat-participant-list",1),t.NdJ("chatParticipant",function(r){return a.selectChatParticipant(r)}),t.qZA()),2&e&&(t.xp6(1),t.Q6J("chatParticipants",a.chatParticipants)("blockedUsersLists",a.blockedUsersLists)("headers",a.headers))},directives:[nt,Pt],styles:["button[_ngcontent-%COMP%]{margin-right:10px}  .mat-form-field-wrapper{padding-bottom:0}"]}),i})();var Lt=c(9224);let Ut=(()=>{class i{constructor(e,a){this.fb=e,this.selectedChatParticipant=null,this.actionButtonLabel="Create",this.action=new t.vpe,this.tempDateTime=new Date(Date.UTC((new Date).getUTCFullYear(),(new Date).getUTCMonth(),(new Date).getUTCDate(),(new Date).getUTCHours(),(new Date).getUTCMinutes(),(new Date).getUTCSeconds())).toISOString(),this.tempDateTime2=this.tempDateTime.replace("T"," "),this.tempDateTime3=this.tempDateTime2.slice(0,19),this.tempDateTime4=this.tempDateTime3+" UTC",this.chatParticipantService=a,this.form=this.fb.group({id:[""],speaker:[{value:localStorage.getItem("userEmail"),disabled:!0}],talkContent:[""],createdAt:[{value:this.tempDateTime4,disabled:!0}],chatWith:[{}]})}ngOnInit(){this.setCreatedAtFieldForCreateActionWithCurrentDateTime(),localStorage.setItem("createdAt",this.form.value.createdAt),this.checkAction()}setCreatedAtFieldForCreateActionWithCurrentDateTime(){this.form.value.createdAt=this.tempDateTime4}checkAction(){this.selectedChatParticipant?(this.actionButtonLabel="Update",this.patchDataValues()):this.selectedChatParticipant||this.handleFormChatWith()}handleFormChatWith(){this.form.patchValue({chatWith:this.chatParticipantService.chatWith}),this.form.controls.chatWith.disable()}patchDataValues(){this.selectedChatParticipant&&(this.form.patchValue(this.selectedChatParticipant),this.form.controls.chatWith.disable()),null!=this.selectedChatParticipant&&null!=this.selectedChatParticipant.createdAt&&localStorage.setItem("createdAt",this.selectedChatParticipant.createdAt)}emitAction(){var e;this.form.value.speaker=localStorage.getItem("userEmail"),this.form.value.createdAt=localStorage.getItem("createdAt"),"Update"==this.actionButtonLabel?this.form.value.chatWith=null===(e=this.selectedChatParticipant)||void 0===e?void 0:e.chatWith:"Create"==this.actionButtonLabel&&(this.form.value.chatWith=this.chatParticipantService.chatWith),this.chatParticipantService.chatWith=this.form.value.chatWith,localStorage.removeItem("createdAt"),this.action.emit({value:this.form.value,action:this.actionButtonLabel})}clear(){this.form.controls.talkContent.setValue("")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(m.qu),t.Y36(k))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-chat-participant-form"]],inputs:{selectedChatParticipant:"selectedChatParticipant"},outputs:{action:"action"},decls:26,vars:3,consts:[[1,"form-card"],[1,"chat-participant-form",3,"formGroup"],["appearance","fill",1,"field-full-width"],["matInput","","formControlName","speaker","placeholder","Ex. teacher@mail.com"],["matInput","","formControlName","talkContent","placeholder","Ex. Hello!"],[1,"button-group"],["matInput","","formControlName","createdAt","placeholder","Ex. 2024-06-03 13:20:00 UTC"],["matInput","","formControlName","chatWith","placeholder","Ex. student@mail.com"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"mat-card",0)(1,"h2"),t._uU(2),t.qZA(),t.TgZ(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),t._uU(6,"Speaker"),t.qZA(),t._UZ(7,"input",3),t.qZA(),t.TgZ(8,"mat-form-field",2)(9,"mat-label"),t._uU(10,"Content"),t.qZA(),t._UZ(11,"input",4),t.qZA(),t.TgZ(12,"div",5)(13,"mat-form-field",2)(14,"mat-label"),t._uU(15,"CreatedAt"),t.qZA(),t._UZ(16,"input",6),t.qZA(),t.TgZ(17,"mat-form-field",2)(18,"mat-label"),t._uU(19,"ChatWith"),t.qZA(),t._UZ(20,"input",7),t.qZA(),t.TgZ(21,"button",8),t.NdJ("click",function(){return a.emitAction()}),t._uU(22),t.qZA(),t._uU(23," \xa0 "),t.TgZ(24,"button",9),t.NdJ("click",function(){return a.clear()}),t._uU(25," Clear "),t.qZA()()()()),2&e&&(t.xp6(2),t.Oqu(a.selectedChatParticipant?"Update/View Speaker":"Create Speaker"),t.xp6(1),t.Q6J("formGroup",a.form),t.xp6(19),t.hij(" ",a.actionButtonLabel," "))},directives:[Lt.a8,m._Y,m.JL,m.sg,O.KE,O.hX,x.Nt,m.Fj,m.JJ,m.u,v.lW],styles:[".chat-participant-form[_ngcontent-%COMP%]{min-width:500px;max-width:800px;width:100%}.field-full-width[_ngcontent-%COMP%]{width:100%}.form-card[_ngcontent-%COMP%]{min-width:500px;max-width:800px;margin:auto}.button-group[_ngcontent-%COMP%]{margin-bottom:15px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px;float:right}.mat-card[_ngcontent-%COMP%]:not([class*=mat-elevation-z]){box-shadow:2px 8px 4px -4px #3f51b5,2px 4px 4px #3f51b5,2px 6px 12px #3f51b5}mat-card[_ngcontent-%COMP%]{border-radius:15px}.mat-raised-button[_ngcontent-%COMP%]{border-radius:10px}  .mat-form-field-wrapper{padding-bottom:0}"]}),i})(),H=(()=>{class i{constructor(e,a){this.router=e,this.store=a,this.chatParticipant=null,this.chatParticipant$=this.store.select((i=>(0,n.P1)(B,s=>s.chatParticipants.find(e=>e.id===i)))(this.router.snapshot.params.id)),this.chatParticipant$.subscribe(r=>{r&&null==this.chatParticipant?this.chatParticipant=r:r&&null!=this.chatParticipant&&r.speaker==localStorage.getItem("userEmail")&&(this.chatParticipant.talkContent=r.talkContent)})}ngOnInit(){}formAction(e){switch(e.action){case"Create":return void this.store.dispatch({type:l.ADD_CHAT_PARTICIPANT_API,payload:e.value});case"Update":return void this.store.dispatch({type:l.MODIFY_CHAT_PARTICIPANT_API,payload:e.value})}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(b.gz),t.Y36(n.yh))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-form"]],decls:1,vars:1,consts:[[3,"selectedChatParticipant","action"]],template:function(e,a){1&e&&(t.TgZ(0,"app-chat-participant-form",0),t.NdJ("action",function(r){return a.formAction(r)}),t.qZA()),2&e&&t.Q6J("selectedChatParticipant",a.chatParticipant)},directives:[Ut],styles:[".mat-form-field-wrapper{padding-bottom:0}"]}),i})();const At=[{path:"",component:gt},{path:"form",children:[{path:"",component:H},{path:":id",component:H}]}];let bt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[b.Bz.forChild(At)],b.Bz]}),i})();var St=c(8864);const Et=(0,n.Lq)({chatParticipants:[]},(0,n.on)(j,(i,{chatParticipants:s})=>Object.assign(Object.assign({},i),{chatParticipants:s})),(0,n.on)(J,(i,{chatParticipantId:s})=>Object.assign(Object.assign({},i),{chatParticipants:i.chatParticipants.filter(e=>e.id!=s)})),(0,n.on)(Y,(i,{chatParticipant:s})=>Object.assign(Object.assign({},i),{chatParticipants:[...i.chatParticipants,s]})),(0,n.on)($,(i,{chatParticipant:s})=>Object.assign(Object.assign({},i),{chatParticipants:i.chatParticipants.map(e=>e.id===s.id?s:e)})),(0,n.on)(V,i=>Object.assign(Object.assign({},i),{chatParticipants:[]})));var h=c(4394),T=c(515),K=c(4128),P=c(5577),g=c(4004);let It=(()=>{class i{constructor(e,a,o){this.actions$=e,this.chatParticipantService=a,this.router=o,this.getChatParticipants$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(l.GET_CHAT_PARTICIPANT_LIST),(0,P.z)(()=>this.chatParticipantService.getChatParticipants().pipe((0,g.U)(r=>({type:l.SET_CHAT_PARTICIPANT_LIST,chatParticipants:r})),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.addChatParticipant$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(l.ADD_CHAT_PARTICIPANT_API),(0,P.z)(r=>this.chatParticipantService.addChatParticipant(r.payload).pipe((0,g.U)(U=>({type:l.ADD_CHAT_PARTICIPANT_STATE,chatParticipant:r.payload})),(0,f.b)(()=>this.router.navigate(["chat-participants"])),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.modifyChatParticipant$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(l.MODIFY_CHAT_PARTICIPANT_API),(0,P.z)(r=>this.chatParticipantService.updateChatParticipant(r.payload.id,r.payload).pipe((0,g.U)(U=>({type:l.MODIFY_CHAT_PARTICIPANT_STATE,chatParticipant:r.payload})),(0,f.b)(()=>this.router.navigate(["chat-participants"])),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.removeChatParticipant$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(l.REMOVE_CHAT_PARTICIPANT_API),(0,P.z)(r=>this.chatParticipantService.deleteChatParticipant(r.payload).pipe((0,g.U)(()=>({type:l.REMOVE_CHAT_PARTICIPANT_STATE,chatParticipantId:r.payload})),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.removeAllChatParticipant$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(l.REMOVE_ALL_CHAT_PARTICIPANT_API),(0,P.z)(r=>(0,K.D)([...r.payload.map(U=>this.chatParticipantService.deleteChatParticipant(U))]).pipe((0,g.U)(()=>({type:l.REMOVE_ALL_CHAT_PARTICIPANT_STATE})),(0,d.K)(()=>T.E)))),{dispatch:!0})}deleteOldPosts(e){let a=new Date,o=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()),r=new Date(o).toISOString().replace("T"," ");return e.slice(0,13)==r.slice(0,13)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(h.eX),t.LFG(k),t.LFG(b.F0))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})();const vt=(0,n.Lq)({blockedUsersLists:[]},(0,n.on)(Q,(i,{blockedUsersLists:s})=>Object.assign(Object.assign({},i),{blockedUsersLists:s})),(0,n.on)(X,(i,{blockedUsersListId:s})=>Object.assign(Object.assign({},i),{blockedUsersLists:i.blockedUsersLists.filter(e=>e.id!=s)})),(0,n.on)(z,(i,{blockedUsersList:s})=>Object.assign(Object.assign({},i),{blockedUsersLists:[...i.blockedUsersLists,s]})),(0,n.on)(q,(i,{blockedUsersList:s})=>Object.assign(Object.assign({},i),{blockedUsersLists:i.blockedUsersLists.map(e=>e.id===s.id?s:e)})),(0,n.on)(tt,i=>Object.assign(Object.assign({},i),{blockedUsersLists:[]})));let Dt=(()=>{class i{constructor(e,a,o){this.actions$=e,this.router=a,this.blockedUsersListService=o,this.getBlockedUsersLists$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(p.GET_BLOCKED_USERS_LIST_LIST),(0,P.z)(()=>this.blockedUsersListService.getBlockedUsersLists().pipe((0,g.U)(r=>({type:p.SET_BLOCKED_USERS_LIST_LIST,blockedUsersLists:r})),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.addBlockedUsersList$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(p.ADD_BLOCKED_USERS_LIST_API),(0,P.z)(r=>this.blockedUsersListService.addBlockedUsersList(r.payload).pipe((0,g.U)(U=>({type:p.ADD_BLOCKED_USERS_LIST_STATE,blockedUsersList:r.payload})),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.modifyBlockedUsersList$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(p.MODIFY_BLOCKED_USERS_LIST_API),(0,P.z)(r=>this.blockedUsersListService.updateBlockedUsersList(r.payload).pipe((0,g.U)(U=>({type:p.MODIFY_BLOCKED_USERS_LIST_STATE,blockedUsersList:r.payload})),(0,f.b)(()=>this.router.navigate(["blocked-users-lists"])),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.removeBlockedUsersList$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(p.REMOVE_BLOCKED_USERS_LIST_API),(0,P.z)(r=>this.blockedUsersListService.deleteBlockedUsersList(r.payload).pipe((0,g.U)(()=>({type:p.REMOVE_BLOCKED_USERS_LIST_STATE,blockedUsersListId:r.payload})),(0,d.K)(()=>T.E)))),{dispatch:!0}),this.removeAllBlockedUsersList$=(0,h.GW)(()=>this.actions$.pipe((0,h.l4)(p.REMOVE_ALL_BLOCKED_USERS_LIST_API),(0,P.z)(r=>(0,K.D)([...r.payload.map(U=>this.blockedUsersListService.deleteBlockedUsersList(U))]).pipe((0,g.U)(()=>({type:p.REMOVE_ALL_BLOCKED_USERS_LIST_STATE})),(0,d.K)(()=>T.E)))),{dispatch:!0})}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(h.eX),t.LFG(b.F0),t.LFG(M))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac}),i})(),Bt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[I.JX,A.ez,bt,m.UX,St.q,E.JF,n.Aw.forFeature("chatParticipantState",Et),h.sQ.forFeature([It]),n.Aw.forFeature("blockedUsersListState",vt),h.sQ.forFeature([Dt])]]}),i})()}}]);